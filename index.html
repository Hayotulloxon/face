<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>Yuz Chiroyliligi O'lchagich</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body {
      background: linear-gradient(120deg, #f9d423, #ff4e50);
      min-height: 100vh;
      color: #222;
    }
    .wow-card {
      background: #fff;
      border-radius: 2rem;
      box-shadow: 0 8px 40px 0 rgba(0,0,0,0.2);
      padding: 2rem;
      margin-top: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .result-section { margin-top: 2rem; }
    .face-img {
      max-width: 250px;
      border-radius: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px 0 rgba(0,0,0,0.15);
    }
    .score-bar {
      height: 1.2rem;
      border-radius: 0.6rem;
      background: #f5f5f5;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    .score-fill {
      height: 100%;
      background: linear-gradient(90deg, #43cea2, #185a9d);
      transition: width 1s;
    }
    .wow-brand {
      font-family: 'Pacifico', cursive;
      color: #ff4e50;
      font-size: 2.4rem;
      margin-bottom: 1rem;
      text-shadow: 0 2px 12px #f9d42380;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="wow-card animate__animated animate__fadeInDown">
      <div class="wow-brand text-center">WOW Yuz Chiroyliligi O'lchagich üòç</div>
      <form id="faceForm" class="mb-4" autocomplete="off">
        <input type="file" id="faceInput" accept="image/*" class="form-control mb-3" required>
        <button type="submit" class="btn btn-warning btn-lg w-100">Yuzni Baholash</button>
      </form>
      <div id="loading" class="text-center text-info" style="display:none;">
        <div class="spinner-border"></div>
        <div>Yuz aniqlanmoqda...</div>
      </div>
      <div id="result" class="result-section"></div>
    </div>
  </div>
  <!-- Eng tez yuz aniqlash uchun Mediapipe JS -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script>
    // Demo uchun baholash (FaceMesh bilan haqiqiy baholash qilish mumkin, hozircha 100)
    function rateFace(box) {
      return {
        eyeScore: 100,
        noseScore: 100,
        mouthScore: 100,
        symScore: 100,
        overall: 100
      };
    }

    // Mediapipe yuz aniqlash
    const faceDetection = new FaceDetection.FaceDetection({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`
    });
    faceDetection.setOptions({
      model: 'short',
      minDetectionConfidence: 0.5
    });

    const fileInput = document.getElementById('faceInput');
    const form = document.getElementById('faceForm');
    const loading = document.getElementById('loading');
    const resultDiv = document.getElementById('result');

    let img = null;
    let canvas = document.createElement('canvas');
    let ctx = canvas.getContext('2d');

    // Formani submit qilishni to'liq to'g'ri ushlab, sayfa yangilanishini to'xtatamiz
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      resultDiv.innerHTML = '';
      loading.style.display = '';
      const file = fileInput.files[0];
      if (!file) return;
      img = new Image();
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        faceDetection.send({image: img});
      };
      img.src = URL.createObjectURL(file);
    });

    faceDetection.onResults((results) => {
      loading.style.display = 'none';
      if (!results.detections || results.detections.length === 0) {
        resultDiv.innerHTML =
        `<div class="alert alert-danger animate__animated animate__bounceIn">
          <b>Rasmda yuz yo'q!</b><br>Yuz aniqlanmadi. Iltimos, aniq yuzli rasm yuklang.
        </div>`;
        return;
      }

      // Birinchi yuz uchun (bir nechta bo'lsa, loop qilsa bo'ladi)
      const detection = results.detections[0];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);
      DrawingUtils.drawRectangle(ctx, detection.boundingBox, {color: 'lime', lineWidth: 4});

      const imgSrc = canvas.toDataURL();
      const scores = rateFace(detection.boundingBox);

      resultDiv.innerHTML = `
        <div class="text-center">
          <img src="${imgSrc}" class="face-img animate__animated animate__fadeIn"/>
        </div>
        <div class="score-bar mb-2"><div class="score-fill" style="width: ${scores.eyeScore}%;"></div></div>
        <b>Ko'zlar nisbati:</b> <span>${scores.eyeScore}/100</span><br>
        <div class="score-bar mb-2"><div class="score-fill" style="width: ${scores.noseScore}%;"></div></div>
        <b>Burun uzunligi:</b> <span>${scores.noseScore}/100</span><br>
        <div class="score-bar mb-2"><div class="score-fill" style="width: ${scores.mouthScore}%;"></div></div>
        <b>Og'iz kengligi:</b> <span>${scores.mouthScore}/100</span><br>
        <div class="score-bar mb-2"><div class="score-fill" style="width: ${scores.symScore}%;"></div></div>
        <b>Simmetriya:</b> <span>${scores.symScore}/100</span><br>
        <hr>
        <div class="display-5 fw-bold text-center text-success animate__animated animate__pulse">
          Umumiy baho: <span>${scores.overall}/100</span>
        </div>
        <div class="text-center mt-2">
          <span style="font-size:2rem;">${
            scores.overall > 85 ? 'üòç' : (scores.overall > 60 ? 'üòä' : 'üôÇ')
          }</span>
        </div>
      `;
    });
  </script>
</body>
</html>
